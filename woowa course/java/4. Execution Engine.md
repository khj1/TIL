# 실행 엔진(Execution Engine)

![image](https://github.com/khj1/TIL/assets/74335027/24e2c11a-706c-43c7-b909-00a4bc005908)

실행 엔진은 클래스 로더를 통해 런타임 데이터 영역에 배치된 **바이트 코드를 명령어 단위**로 읽어서 실행한다.

자바 바이트 코드(.class)는 기계가 바로 수행할 수 있는 언어라기 보다는, 가상머신이 이해할 수 있는 중간 레벨로 컴파일 된 코드이다. 그래서 실행 엔진이 이와 같은 바이트 코드를 실제로 JVM 내부에서 기계가 실행할 수 있는 형태로 변경해준다.

이 수행 과정에서 실행 엔진은 **인터프리터**와 **JIT 컴파일러** 두 가지 방식을 혼합하여 바이트 코드를 실행한다.

## 인터프리터(Interpreter)
바이트 코드 **명령어를 하나씩 읽어서 해석하고 바로 실행한다.**

JVM안에서 바이트코드는 기본적으로 인터프리터 방식으로 동작한다. 다만 같은 메소드라도 여러번 호출된다면 매번 해석하고 수행해야하기 때문에 전체적인 속도가 느리다.

## JIT 컴파일러(Just In Time)
느린 인터프리터의 단점을 보완하기 위해 도입된 방식이다. **반복되는 코드를 발견하여 바이트 코드 전체를 컴파일하여 Native Code로 변경**하고 이후에는 해당 메서드를 더 이상 인터프리터를 통해 해석하지 않는다. **코드를 캐싱해두었다가 네이티브 코드로 직접 실행하는 방식**이다.

컴파일된 네이티브 코드 자체를 실행하는 것이기 때문에 전체적인 속도는 인터프리터 방식보다 빠르다. 하지만 바이트코드를 네이티브 코드로 변환하는 과정에서 비용이 발생한다. JVM은 모든 코드를 JIT 컴파일러 방식으로 실행하지 않고 인터프리터 방식을 사용하다가 일정 기준을 넘어서면 JIT 컴파일러 방식으로 명령어를 실행한다.

> 네이티브 코드란 JAVA의 부모가 되는 C언어나 C++, 어셈블리어로 구성된 코드를 의미한다.

> **JNI (Java Native Interface)** <br />
> JNI는 자바가 다른 언어로 만들어진 어플리케이션과 상호 작용할 수 있는 인터페이스를 제공하는 프로그램이다.<br />
> JNI는 Java Native Method를 적재하고 수행할 수 있도록 한다.<br />
> 하지만 실질적으로 제대로 동작하는 언어는 C / C++ 정도 밖에 없다고 한다.

> **Native Method Library**
> C, C++로 작성된 라이브러리를 칭한다. <br />
> 만일 헤더가 필요하면 JNI는 이 라이브러리를 로딩해 실행한다.
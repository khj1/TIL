# CDN (Contents Delivery Network)
- 정적 컨텐츠를 전송하는 데 쓰이는 지리적으로 분산된 여러 개의 서버를 의미한다.
- 사용자와 가까운 곳에서 데이터를 전송함으로써 전송 속도를 높일 수 있다.
- CDN은 웹 페이지, 이미지, 비디오 등의 컨텐츠를 사용자의 물리적 위치와 가까운 프록시 서버에 캐싱한다.
- CDN은 항상 물리적으로 가까운 서버를 최우선으로 하지 않는다.
- 사용자에게 가장 빠른 응답을 줄 수 있는 서버를 최우선으로 한다.

> CDN을 ATM에 대입해서 생각해보면 더 쉽게 이해할 수 있다.

## CDN 동작 방식
1. 최초 요청은 서버로부터 컨텐츠를 가져와 고객에게 전송하며 동시에 CDN 캐싱 장비에 저장한다.
2. 최초 요청 이후로의 요청은 CDN에서 저장하는 해당 컨텐츠의 만료 시점까지 캐싱된 컨텐츠를 전송한다.
3. 자주 사용하는 페이지에 한해서 캐싱되며, 해당 컨텐츠 호출이 없을 경우 주기적으로 삭제된다.
4. 서버가 파일을 찾는데 실패할 경우 CDN 플랫폼의 다른 서버에서 컨텐츠를 찾은 다음 엔드 유저에게 전송한다.
5. 컨텐츠를 사용할 수 없거나 오래된 경우 CDN은 향후 요청에 대해 응답할 수 있도록 새로운 컨텐츠를 저장한다.

## CDN 캐싱 방식
### Static Caching
- Origin Server에 있는 Contents를 운영자가 미리 Cache Server에 복사해둔다.
- 사용자가 Cache Server에 있는 Contents 요청 시 무조건 Cache hit이 가능하다.
- 대부분의 국내 CDN에서 이 방식을 사용한다.

### Dynamic Caching
- Origin Server에 있는 Contents를 운영자가 미리 Cache Server에 복사하지 않는다.
- 사용자가 Contents를 요청 시 해당 Content가 없는 경우 Origin Server로부터 다운로드 받아 전달한다.
- 해당 Content가 있는 경우 캐싱된 Content를 전달한다.

## CDN은 동적 컨텐츠를 어떻게 캐싱할까?
- 동적 컨텐츠를 바이트 단위로 분석해서 변한 부분만 새로 받아오도록 한다.
- 서버에서 사용자까지 데이터가 전달되는 경로를 최적화한다.
- 데이터를 압축해서 전달한다.
- Handshake 과정을 간소화한다.
- 캐싱 유지 시간(TTL, Time To Live)을 어느정도 짧게 유지해서 실서버로의 접속량을 최소한으로 만들 수 있다.

> **CDN과 DNS** <br />
> CDN을 사용하면 DNS를 통해 원본 서버의 IP 주소가 아니라 CDN을 총괄하는 서버의 IP 주소를 할당해줘야 한다. 그러면 CDN은 사용자에게 가장 빠른 응답을 줄 수 있는 CDN 서버(Edge)를 조회해서 서버와 사용자를 주선해주게 된다.

## CDN 사용의 비용적 이점
- CDN을 사용하게 되면 서버에 직접 데이터를 요청하지 않기 때문에 대역폭 비용이 크게 절감된다.
- 이로인해 본 서버가 받는 부담이 덜어지니까 서버의 안정성 또한 높아진다.

> **대역폭이란?** <br />
> 주어진 시간동안 데이터가 전송될 수 있는 크기를 말한다. <br />
> 도로에 비교해볼 때 전송 시간은 도로의 제한 속도, 대역폭은 도로의 차선 수를 의미한다.